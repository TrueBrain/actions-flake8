name: 'Flake8 with annotations'
author: 'Patric "TrueBrain" Stout'
description: 'Flake8 with annotations for Pull Request'
inputs:
  path:
    description: 'Path to run flake8 in'
    required: false
    default: ''
  ignore:
    description: 'Skip errors and warnings (e.g. E4,W)'
    required: false
    default: ''
  max_line_length:
    description: 'Set maximum allowed line length'
    required: false
    default: ''
  only_warn:
    description: 'If set, only warn, never error'
    required: false
    default: ''
  flake8_version:
    description: 'What flake8 version to use, if none is installed (default is latest)'
    required: false
    default: ''
  use_bugbear:
    description: 'If true, will install flake8-bugbear plugin'
    required: false
    default: false
  bugbear_version:
    description: 'What flake8-bugbear version to use, if none is installed (default is latest)'
    required: false
    default: ''
runs:
  using: 'composite'
  steps:
  - run: |
      if [ -z "${{ inputs.flake8_version }}" ]; then
        flake8_version=""
      else
        flake8_version="==${{ inputs.flake8_version }}"
      fi
      pip show -q flake8 || pip install flake8${flake8_version}
    shell: bash
  - if: ${{ inputs.use_bugbear }}
    run: |
      if [ -z "${{ inputs.bugbear_version }}" ]; then
        bugbear_version=""
      else
        bugbear_version="==${{ inputs.bugbear_version }}"
      fi
      pip show -q flake8-bugbear || pip install flake8-bugbear${bugbear_version}
    shell: bash
  - run: ${{ github.action_path }}/action/entrypoint.sh
    shell: bash
    env:
      INPUT_PATH: ${{ inputs.path }}
      INPUT_IGNORE: ${{ inputs.ignore }}
      INPUT_MAX_LINE_LENGTH: ${{ inputs.max_line_length }}
      INPUT_ONLY_WARN: ${{ inputs.only_warn }}
      INPUT_FLAKE8_VERSION: ${{ inputs.flake8_version }}
branding:
  icon: 'code'
  color: 'blue'
